<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Tes KESWA by Binjas Perkasa</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f9; color: #333; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        #app-container { background-color: #ffffff; border-radius: 12px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1); width: 100%; max-width: 800px; padding: 30px 40px; text-align: center; }
        h1, h2, h3, h4 { color: #2c3e50; }
        p { color: #555; line-height: 1.6; }
        .btn { padding: 15px 30px; font-size: 1em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; min-width: 120px; margin: 5px; }
        .btn-primary { background-color: #3498db; color: white; }
        .btn-primary:hover { background-color: #2980b9; }
        .btn-primary:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        .btn-secondary { background-color: #95a5a6; color: white; }
        .btn-secondary:hover { background-color: #7f8c8d; }
        .btn-secondary:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        #name-input { width: 80%; padding: 12px; font-size: 1em; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 8px; }
        #instructions { text-align: left; background-color: #ecf0f1; padding: 15px; border-radius: 8px; margin: 20px 0; }
        #question-container { margin: 20px 0; min-height: 100px; display: flex; align-items: center; justify-content: center; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; background-color: #fafafa; }
        #question-text { font-size: 1.2em; font-weight: 500; }
        #answer-buttons { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .btn-yes { background-color: #27ae60; color: white; }
        .btn-yes:hover { background-color: #229954; }
        .btn-no { background-color: #c0392b; color: white; }
        .btn-no:hover { background-color: #a93226; }
        #timer { font-size: 1.5em; font-weight: bold; color: #34495e; padding: 10px; background-color: #ecf0f1; border-radius: 8px; margin-bottom: 15px; }
        #progress-container { width: 100%; background-color: #ecf0f1; border-radius: 5px; margin-top: 20px; }
        #progress-bar { width: 0%; height: 15px; background-color: #3498db; border-radius: 5px; transition: width 0.3s ease-in-out; }
        .analysis-block, .validity-block { margin-top: 20px; padding: 15px; border-left: 5px solid; background-color: #f8f9f9; border-radius: 0 8px 8px 0; text-align: left; }
        .validity-invalid { border-color: #c0392b; background-color: #fbeee6; }
        .validity-questionable { border-color: #f39c12; background-color: #fef5e7; }
        .validity-valid { border-color: #27ae60; }
        #final-verdict { padding: 20px; font-size: 1.8em; font-weight: bold; color: white; border-radius: 8px; margin-bottom: 20px; text-transform: uppercase; }
        .verdict-ms { background-color: #27ae60; }
        .verdict-tms { background-color: #c0392b; }
        #clinical-scales-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        #clinical-scales-table th, #clinical-scales-table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        #clinical-scales-table th { background-color: #ecf0f1; }
        .score-interpretation { font-weight: bold; }
        .score-low { color: #2c3e50; }
        .score-moderate { color: #f39c12; }
        .score-high { color: #c0392b; }
        .disclaimer { font-size: 0.8em; color: #e74c3c; font-weight: bold; margin-top: 20px; border: 1px dashed #e74c3c; padding: 10px; border-radius: 5px; text-align: center; }
        [style*="display: none"] { display: none !important; }
        
        @media print {
            body { background-color: #fff; -webkit-print-color-adjust: exact; color-adjust: exact; }
            #app-container { box-shadow: none; border: 1px solid #ccc; width: 100%; max-width: 100%; }
            #print-btn, .disclaimer, #answer-buttons, #progress-container, #timer, #question-container, #test-options-buttons, #welcome-container, #options-container, #test-container { display: none !important; }
            #result-container { display: block !important; }
            .analysis-block, .validity-block { background-color: #fff; }
            #final-verdict, .verdict-ms, .verdict-tms { color: white !important; }
            .verdict-ms { background-color: #27ae60 !important; }
            .verdict-tms { background-color: #c0392b !important; }
        }
    </style>
</head>
<body>
    <div id="app-container">
        
        <div id="welcome-container">
            <h1>Selamat Datang di Aplikasi Tes KESWA</h1>
            <p>Silakan masukkan nama Anda dan baca instruksi dengan teliti sebelum memulai.</p>
            <input type="text" id="name-input" placeholder="Masukkan Nama Lengkap Anda">
            <div id="instructions">
                <h4>Instruksi Pengerjaan:</h4>
                <ul>
                    <li>Anda akan dihadapkan pada sejumlah pernyataan tentang diri Anda.</li>
                    <li>Pilihlah jawaban <strong>YA</strong> atau <strong>TIDAK</strong> yang paling sesuai.</li>
                    <li>Jawablah dengan jujur dan spontan. Tidak ada jawaban yang benar atau salah.</li>
                    <li>Waktu pengerjaan terbatas dan akan ditampilkan di layar.</li>
                </ul>
            </div>
            <button id="continue-btn" class="btn btn-primary" disabled>Lanjut</button>
        </div>

        <div id="options-container" style="display: none;">
            <h2>Halo, <span id="user-name-display"></span>!</h2>
            <p id="loading-status">Memuat soal...</p>
            <p>Silakan pilih versi tes yang ingin Anda kerjakan:</p>
            <div id="test-options-buttons">
                <button class="btn btn-secondary" onclick="startTest(50)" disabled>Cepat (50 Soal)</button>
                <button class="btn btn-secondary" onclick="startTest(120)" disabled>Terpilih (120 Soal)</button>
                <button class="btn btn-secondary" onclick="startTest(565)" disabled>Penuh (565 Soal)</button>
            </div>
        </div>

        <div id="test-container" style="display: none;">
            <div id="timer">00:00</div>
            <div id="question-container"><p id="question-text"></p></div>
            <div id="answer-buttons">
                <button class="btn btn-yes" onclick="selectAnswer('YA')">YA</button>
                <button class="btn btn-no" onclick="selectAnswer('TIDAK')">TIDAK</button>
            </div>
            <div id="progress-container"><div id="progress-bar"></div></div>
            <p id="progress-text"></p>
        </div>

        <div id="result-container" style="display: none;">
            <h2>Hasil Analisis untuk <span id="result-user-name"></span></h2>
            <div id="final-verdict"></div>
            <div id="retest-recommendation" style="font-style: italic; margin-top: -10px; margin-bottom: 20px;"></div>
            
            <div id="validity-analysis"></div>
            
            <div id="personality-analysis" style="display: none;">
                <hr>
                <h3>Analisis Kepribadian Umum</h3>
                <p id="score-summary"></p>
                <div id="analysis-result"></div>
            </div>

            <div id="clinical-scales-container" style="display: none;">
                <hr>
                <h3>Analisis Skala Klinis (Simulasi MMPI)</h3>
                <div class="disclaimer" style="text-align:left; color: #d35400; border-color: #d35400;">
                    <strong>Peringatan:</strong> Analisis berikut adalah simulasi edukatif dan BUKAN hasil tes MMPI-2 yang sebenarnya. Pemetaan soal bersifat konseptual dan tidak memiliki validitas empiris.
                </div>
                <div id="clinical-scales-analysis"></div>
            </div>

            <button id="print-btn" class="btn btn-secondary" onclick="window.print()" style="margin-top:20px;">Cetak / Simpan Hasil</button>
        </div>
    </div>

<script>
// --- KONFIGURASI SKALA ---
const validityScales = { L: { 45: 'TIDAK', 75: 'TIDAK', 93: 'TIDAK', 120: 'TIDAK', 225: 'TIDAK', 316: 'TIDAK', 393: 'TIDAK', 465: 'TIDAK', 481: 'TIDAK', 503: 'YA' }, F: { 27: 'YA', 50: 'YA', 66: 'YA', 151: 'YA', 184: 'YA', 200: 'YA', 275: 'YA', 291: 'YA', 350: 'YA', 420: 'YA', 433: 'YA', 476: 'YA', 554: 'YA' }, K: { 26: 'YA', 36: 'YA', 79: 'TIDAK', 138: 'TIDAK', 158: 'TIDAK', 170: 'YA', 236: 'YA', 336: 'TIDAK', 408: 'TIDAK', 416: 'TIDAK' } };
const selected120Indices = [1, 2, 3, 5, 8, 10, 13, 16, 21, 22, 24, 26, 27, 28, 32, 33, 35, 36, 39, 40, 41, 43, 45, 48, 50, 52, 56, 61, 62, 66, 74, 75, 76, 79, 84, 86, 90, 91, 93, 94, 97, 100, 102, 104, 106, 109, 110, 114, 117, 120, 121, 123, 127, 129, 138, 139, 142, 146, 147, 151, 156, 157, 158, 162, 165, 168, 170, 172, 179, 182, 184, 189, 191, 194, 200, 202, 205, 209, 212, 216, 218, 225, 228, 235, 236, 238, 239, 244, 245, 251, 252, 259, 265, 266, 267, 271, 275, 278, 282, 284, 286, 290, 291, 292, 296, 301, 303, 305, 315, 316, 317, 319, 326, 333, 336, 338, 339, 345, 350, 351, 358, 360, 364, 366, 368, 374, 383, 388, 389, 393, 397, 402, 404, 408, 414, 416, 421, 433, 442, 448, 459, 465, 476, 481, 487, 499, 503, 506, 518, 526, 534, 544, 548, 554, 558, 564];
const clinicalScales = {
    Sc1: { name: '1 (Hs)', description: 'Hypochondriasis: Perhatian berlebih pada fungsi tubuh dan keluhan fisik.', items: {23:'YA', 29:'YA', 34:'YA', 44:'YA', 72:'YA', 108:'YA', 125:'YA', 161:'YA', 189:'YA', 243:'YA'} },
    Sc2: { name: '2 (D)', description: 'Depression: Kesedihan, pesimisme, kehilangan minat, dan perasaan tidak berharga.', items: {16:'YA', 76:'YA', 84:'YA', 142:'YA', 236:'YA', 301:'YA', 339:'YA', 411:'YA', 418:'YA', 487:'YA', 526:'YA'} },
    Sc3: { name: '3 (Hy)', description: 'Hysteria: Penyangkalan masalah dan keluhan fisik spesifik saat stres.', items: {10:'YA', 22:'YA', 158:'YA', 246:'YA', 332:'YA', 405:'TIDAK', 408:'TIDAK', 523:'YA', 539:'TIDAK'} },
    Sc4: { name: '4 (Pd)', description: 'Psychopathic Deviate: Konflik dengan otoritas, anti-sosial, dan impulsif.', items: {28:'YA', 38:'YA', 56:'YA', 97:'YA', 109:'YA', 118:'YA', 145:'YA', 205:'YA', 313:'YA', 417:'YA', 438:'YA'} },
    Sc5: { name: '5 (Mf)', description: 'Interests: Pola minat maskulin/feminin (simulasi sederhana).', items: {1:'TIDAK', 4:'YA', 25:'YA', 74:'YA', 81:'YA', 92:'YA', 378:'YA', 423:'TIDAK', 435:'YA', 537:'YA'} },
    Sc6: { name: '6 (Pa)', description: 'Paranoia: Kecurigaan, rasa permusuhan, dan merasa disalahpahami.', items: {35:'YA', 121:'YA', 123:'YA', 136:'YA', 151:'YA', 200:'YA', 244:'YA', 284:'YA', 364:'YA', 404:'YA'} },
    Sc7: { name: '7 (Pt)', description: 'Psychasthenia: Kecemasan, keraguan, obsesi, dan ketakutan.', items: {32:'YA', 100:'YA', 147:'TIDAK', 337:'YA', 343:'YA', 346:'YA', 351:'YA', 402:'YA', 431:'YA', 499:'YA', 542:'YA'} },
    Sc8: { name: '8 (Sc)', description: 'Schizophrenia: Pikiran aneh, isolasi sosial, dan persepsi tidak wajar.', items: {27:'YA', 50:'YA', 66:'YA', 184:'YA', 251:'YA', 291:'YA', 334:'YA', 345:'YA', 350:'YA', 433:'YA', 554:'YA'} },
    Sc9: { name: '9 (Ma)', description: 'Hypomania: Energi berlebih, euforia/iritabilitas, dan impulsivitas.', items: {134:'YA', 234:'YA', 248:'YA', 268:'YA', 272:'YA', 409:'YA', 415:'YA', 505:'YA'} },
    Sc0: { name: '0 (Si)', description: 'Social Introversion: Rasa malu, canggung, dan menghindari interaksi sosial.', items: {52:'YA', 180:'YA', 305:'YA', 366:'YA', 377:'YA', 449:'TIDAK', 473:'YA', 552:'YA'} }
};
// --- VARIABEL GLOBAL & REFERENSI DOM ---
let allQuestions = [];
let testQuestions = [];
let currentQuestionIndex = 0;
let deviationScore = 0;
let validityScores = { L: 0, F: 0, K: 0 };
let clinicalScores = { Sc1: 0, Sc2: 0, Sc3: 0, Sc4: 0, Sc5: 0, Sc6: 0, Sc7: 0, Sc8: 0, Sc9: 0, Sc0: 0 };
let userName = '';
let timerInterval;
const welcomeContainer = document.getElementById('welcome-container');
const optionsContainer = document.getElementById('options-container');
const testContainer = document.getElementById('test-container');
const resultContainer = document.getElementById('result-container');
const nameInput = document.getElementById('name-input');
const continueBtn = document.getElementById('continue-btn');
const userNameDisplay = document.getElementById('user-name-display');
const loadingStatus = document.getElementById('loading-status');
const testOptionsButtons = document.querySelectorAll('#test-options-buttons button');
const timerEl = document.getElementById('timer');
const questionTextEl = document.getElementById('question-text');
const progressBar = document.getElementById('progress-bar');
const progressTextEl = document.getElementById('progress-text');
const resultUserNameEl = document.getElementById('result-user-name');
const finalVerdictEl = document.getElementById('final-verdict');
const retestRecommendationEl = document.getElementById('retest-recommendation');
const validityAnalysisEl = document.getElementById('validity-analysis');
const personalityAnalysisEl = document.getElementById('personality-analysis');
const scoreSummaryEl = document.getElementById('score-summary');
const analysisResultEl = document.getElementById('analysis-result');
const clinicalScalesContainer = document.getElementById('clinical-scales-container');
const clinicalScalesAnalysisEl = document.getElementById('clinical-scales-analysis');

// --- EVENT LISTENERS & LOGIKA ALUR APLIKASI ---
nameInput.addEventListener('input', () => {
    continueBtn.disabled = nameInput.value.trim() === '';
});

continueBtn.addEventListener('click', () => {
    userName = nameInput.value.trim();
    userNameDisplay.textContent = userName;
    welcomeContainer.style.display = 'none';
    optionsContainer.style.display = 'block';
});

function selectTestQuestions(length) {
    if (length === 565) {
        testQuestions = [...allQuestions];
    } else if (length === 120) {
        testQuestions = selected120Indices.map(index => allQuestions.find(q => q.number === index)).filter(q => q);
    } else if (length === 50) {
        testQuestions = allQuestions.slice(0, 50);
    }
}

function startTest(length) {
    // Memuat soal dari file CSV terpisah
    fetch('data_keswa.csv')
        .then(response => {
            if (!response.ok) {
                throw new Error('Gagal memuat file CSV. Pastikan file ada di folder yang sama.');
            }
            return response.text();
        })
        .then(csvText => {
            allQuestions = parseCSV(csvText);
            if (allQuestions.length < 565) {
                alert("File CSV tidak lengkap atau formatnya salah.");
                return;
            }

            selectTestQuestions(length);
            let durationMinutes;
            if (length === 565) durationMinutes = 90;
            else if (length === 120) durationMinutes = 40;
            else durationMinutes = 15;

            optionsContainer.style.display = 'none';
            testContainer.style.display = 'block';
            
            currentQuestionIndex = 0;
            deviationScore = 0;
            validityScores = { L: 0, F: 0, K: 0 };
            clinicalScores = { Sc1: 0, Sc2: 0, Sc3: 0, Sc4: 0, Sc5: 0, Sc6: 0, Sc7: 0, Sc8: 0, Sc9: 0, Sc0: 0 };
            
            startTimer(durationMinutes);
            showQuestion();
        })
        .catch(error => {
            alert(error.message);
            console.error(error);
        });
}

function parseCSV(text) {
    const lines = text.trim().split(/\r?\n/);
    const data = [];
    // Mulai dari 1 untuk lewati header
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (line) {
            // Regex untuk menangani koma di dalam kutip
            const parts = line.match(/(?:"[^"]*"|[^,]+)/g);
            if(parts && parts.length === 3) {
                const number = parseInt(parts[0]);
                const text = parts[1].replace(/^"|"$/g, '');
                const key = parts[2].trim();
                data.push({ number, text, key });
            }
        }
    }
    return data;
}

function startTimer(minutes) {
    let totalSeconds = minutes * 60;
    timerInterval = setInterval(() => {
        if (totalSeconds < 0) {
            clearInterval(timerInterval);
            alert("Waktu Habis!");
            showResults();
            return;
        }
        const min = Math.floor(totalSeconds / 60);
        const sec = totalSeconds % 60;
        timerEl.textContent = `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
        totalSeconds--;
    }, 1000);
}

function showQuestion() {
    const currentQuestion = testQuestions[currentQuestionIndex];
    questionTextEl.innerText = `${currentQuestion.number}. ${currentQuestion.text}`;
    updateProgress();
}

function updateProgress() {
    const progressPercentage = ((currentQuestionIndex + 1) / testQuestions.length) * 100;
    progressBar.style.width = `${progressPercentage}%`;
    progressTextEl.innerText = `Pertanyaan ${currentQuestionIndex + 1} dari ${testQuestions.length}`;
}

function selectAnswer(userChoice) {
    const currentQuestion = testQuestions[currentQuestionIndex];
    if (userChoice !== currentQuestion.key) deviationScore++;
    checkValidity(currentQuestion.number, userChoice);
    checkClinical(currentQuestion.number, userChoice);

    currentQuestionIndex++;
    if (currentQuestionIndex < testQuestions.length) {
        showQuestion();
    } else {
        clearInterval(timerInterval);
        showResults();
    }
}

function checkValidity(number, choice) {
    if (validityScales.L[number] === choice) validityScores.L++;
    if (validityScales.F[number] === choice) validityScores.F++;
    if (validityScales.K[number] === choice) validityScores.K++;
}

function checkClinical(number, choice) {
    for (const scaleKey in clinicalScales) {
        if (clinicalScales[scaleKey].items[number] === choice) {
            clinicalScores[scaleKey]++;
        }
    }
}

function showResults() {
    testContainer.style.display = 'none';
    resultContainer.style.display = 'block';
    resultUserNameEl.textContent = userName;

    const validityResult = getValidityAnalysis();
    const personalityResult = getMMPIAnalysis(deviationScore, testQuestions.length);
    const finalVerdictResult = getFinalVerdict(validityResult, personalityResult);
    
    validityAnalysisEl.innerHTML = validityResult.analysisHTML;
    finalVerdictEl.textContent = finalVerdictResult.verdict;
    finalVerdictEl.className = 'final-verdict ' + (finalVerdictResult.verdict === 'MS' ? 'verdict-ms' : 'verdict-tms');
    retestRecommendationEl.textContent = finalVerdictResult.retestRecommendation;

    if (validityResult.isValid) {
        personalityAnalysisEl.style.display = 'block';
        scoreSummaryEl.innerHTML = `&bull; Skor Deviasi Umum: <strong>${deviationScore}</strong> (${personalityResult.percentage}%)`;
        analysisResultEl.innerHTML = personalityResult.analysisHTML;

        clinicalScalesContainer.style.display = 'block';
        clinicalScalesAnalysisEl.innerHTML = getClinicalAnalysisHTML();
    } else {
        personalityAnalysisEl.style.display = 'none';
        clinicalScalesContainer.style.display = 'none';
    }
}

function getValidityAnalysis() {
    const L = validityScores.L, F = validityScores.F, K = validityScores.K;
    let isValid = true, analysisHTML = '', status = 'Valid';
    
    if (F >= 7) {
        isValid = false; status = "Tidak Valid (Faking Bad / Random)";
        analysisHTML = `<div class="validity-block validity-invalid"><h4>${status}</h4><p>Skor F (${F}) sangat tinggi, menunjukkan pola jawaban tidak wajar atau sengaja memburuk-burukkan diri. <strong>Profil tidak dapat diinterpretasikan.</strong></p></div>`;
    } else if (L >= 7) {
        isValid = false; status = "Tidak Valid (Faking Good / Naive)";
        analysisHTML = `<div class="validity-block validity-invalid"><h4>${status}</h4><p>Skor L (${L}) sangat tinggi, menunjukkan usaha menampilkan citra diri sempurna secara tidak wajar. <strong>Profil tidak dapat diinterpretasikan.</strong></p></div>`;
    } else if (F >= 4) {
        status = "Valid dengan Keraguan";
        analysisHTML = `<div class="validity-block validity-questionable"><h4>${status}</h4><p>Skor F (${F}) sedikit meningkat, mengindikasikan kemungkinan krisis emosional atau pemikiran eksentrik. Interpretasi harus hati-hati.</p></div>`;
    } else if (K >= 8) {
        status = "Valid (Sangat Defensif)";
        analysisHTML = `<div class="validity-block validity-questionable"><h4>${status}</h4><p>Skor K (${K}) tinggi, menunjukkan sikap sangat defensif. Kemungkinan skor deviasi tampak lebih rendah dari kondisi sebenarnya.</p></div>`;
    } else {
        analysisHTML = `<div class="validity-block validity-valid"><h4>Profil Valid</h4><p>Pola jawaban Anda konsisten dan dapat dipercaya (L=${L}, F=${F}, K=${K}). Analisis kepribadian dapat diinterpretasikan.</p></div>`;
    }
    return { isValid, status, analysisHTML };
}

function getMMPIAnalysis(score, total) {
    const percentage = total > 0 ? parseFloat(((score / total) * 100).toFixed(1)) : 0;
    let analysisHTML = '', category = '';

    if (percentage <= 12) {
        category = "Sangat Direkomendasikan";
        analysisHTML = `<div class="analysis-block profile-recommended"><h4>${category}</h4><p>Profil kepribadian sangat baik, stabil, dan berdaya tahan tinggi. Ideal untuk konteks seleksi.</p></div>`;
    } else if (percentage <= 25) {
        category = "Dipertimbangkan dengan Catatan";
        analysisHTML = `<div class="analysis-block profile-considered"><h4>${category}</h4><p>Profil masih dalam rentang normal, namun ada beberapa area stres. Memerlukan pendalaman lebih lanjut.</p></div>`;
    } else if (percentage <= 40) {
        category = "Cenderung Tidak Direkomendasikan";
        analysisHTML = `<div class="analysis-block profile-not-recommended-tendency"><h4>${category}</h4><p>Menunjukkan adanya masalah psikologis yang signifikan dan berisiko tinggi saat bertugas di bawah tekanan.</p></div>`;
    } else {
        category = "Tidak Direkomendasikan";
        analysisHTML = `<div class="analysis-block profile-not-recommended"><h4>${category}</h4><p>Indikasi kuat adanya psikopatologi. Merupakan kontra-indikasi untuk diterima dalam seleksi.</p></div>`;
    }
    return { category, percentage, analysisHTML };
}

function getClinicalAnalysisHTML() {
    let tableHTML = `<table id="clinical-scales-table">
                        <tr><th>Skala</th><th>Deskripsi</th><th>Skor Anda</th><th>Interpretasi</th></tr>`;
    
    for (const scaleKey in clinicalScales) {
        const scale = clinicalScales[scaleKey];
        const score = clinicalScores[scaleKey];
        let interpretation = '';
        let scoreClass = 'score-low';
        const highThreshold = Math.ceil(Object.keys(scale.items).length * 0.6); // >60%
        const moderateThreshold = Math.ceil(Object.keys(scale.items).length * 0.3); // >30%

        if (score >= highThreshold) {
            interpretation = 'Tinggi';
            scoreClass = 'score-high';
        } else if (score >= moderateThreshold) {
            interpretation = 'Moderat';
            scoreClass = 'score-moderate';
        } else {
            interpretation = 'Rendah';
        }

        tableHTML += `<tr>
                        <td><strong>${scale.name}</strong></td>
                        <td>${scale.description}</td>
                        <td>${score}</td>
                        <td class="score-interpretation ${scoreClass}">${interpretation}</td>
                      </tr>`;
    }

    tableHTML += `</table>`;
    return tableHTML;
}

function getFinalVerdict(validity, personality) {
    let verdict = 'MS';
    let retestRecommendation = '';

    if (!validity.isValid) {
        verdict = 'TMS';
        retestRecommendation = 'REKOMENDASI: Mengulang tes karena profil tidak valid.';
    } else if (personality.category === "Tidak Direkomendasikan" || personality.category === "Cenderung Tidak Direkomendasikan") {
        verdict = 'TMS';
        retestRecommendation = 'REKOMENDASI: Hasil menunjukkan kontra-indikasi psikologis.';
    } else if (validity.status !== 'Valid') { 
        verdict = 'TMS';
        retestRecommendation = 'REKOMENDASI: Mengulang tes untuk mengklarifikasi pola jawaban yang meragukan.';
    }

    return { verdict, retestRecommendation };
}
</script>
</body>
</html>
